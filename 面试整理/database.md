# 数据库
#### 1.什么时候该建立索引？什么时候不该建立索引？如何建立索引？
以下情况的列适合建立索引：
- 频繁查询，比如经常出现在where/order by/group by的字句中，索引可以加速查询
- 唯一性约束，索引的底层是B+树或者哈希表，可以快速查找
- 高选择性列，比如身份证号这类分布比较分散的，性别这种分布均匀的就没必要
- 外键连接，索引可以加速连接，避免全表扫描

不该建立索引：
- 频繁更新，索引会增加开销
- 底选择性，如状态/性别
- 数据小，全表扫描可能更快，索引维护起来还是很精细的

如何建立索引？索引大扫盲：
- 单列索引，在单个列上建立索引
- 多列索引，建立组合索引(这里涉及到最左前缀原则，待会讲)
- 唯一索引，确保列值的唯一性
- 主键索引，主键列会自动创建主键索引
- 全文索引，支持文本列的全文索引
- 覆盖索引，在查询只需要索引列的数据时，就可以建立覆盖索引(理解为该索引可以覆盖全部数据)，避免访问表数据


#### 2.查询索引一定更快吗？分析下列情况怎么使用索引会更快？
和上题本质一样。


#### 3.数据库内核是怎么决定是否使用索引查询以及该用哪个索引查询？如何sampling，怎么计算查询成本和生成执行计划？
首先，数据库里有个东西叫查询优化器。查询优化器通过成本模型和统计信息来评估不同查询计划的成本选最好的。
先细讲查询优化器，该组件会从以下几个因素出发判断是否用索引：
- 涉及到索引列
- 选择性
- 索引可以覆盖查询的所有列
- 匹配的数据量较小时用索引是更好的，否则极端情况下不如全表扫描

在考虑用哪个索引时，会优先选择能覆盖查询条件的索引或者高选择性的索引(比如查where name = 'alice'肯定优先考虑name索引列)

这里的sampling指的是采集表的行数/列的值分布/索引的选择性，通过随机采样，分层采样，系统表实现。

计算查询成本时要考虑到CPU成本，IO读取的成本，使用内存的开销。具体的，常见的成本估算有全表扫描的成本，读取索引页和访问数据页(num_index_pages * page_cost + num_data_pages * page_cost)的成本。

生成执行计划时要先将SQL解析成抽象语法树，然后从语法的角度进行逻辑优化，再从物理角度(选择合适的索引)进行优化，最后选最好的。

#### 4.如何让索引尽可能加速查询操作？
合理设计索引，定期重建索引，对大表进行分区减少索引的查询范围。

#### 5.回表是什么？如何减少回表操作？
数据库需要根据索引找到的主键或行指针，再到数据表中查找完整的数据行。回表操作会增加额外的 I/O 开销，尽量用覆盖索引，使用聚簇索引(比如InnnoDB主键索引是聚簇索引，直接在叶子节点存储行数据，避免回表操作)。

#### 6.如果数据库的io很大，有哪些可能性，该如何排查并定位原因，该如何优化？

#### 7.数据库还有哪些性能指标？

#### 8.为什么主键要用自增id？

#### 9.覆盖索引了解吗，具体怎么用？

#### 10.为什么用B+树不用B树？为什么B+树胖且矮？如果把内容存在内存上，用B树会不会快一点？

#### 11.B+树和B树的时间复杂度有什么区别，有的话差多少？

#### 12.(a1,a2,a3)查找(a2,a3)会找到a1吗(最左前缀原则)？

#### 13.怎么保证数据库和redis一致性？

#### 14.讲一下一条SQL语句查询的全过程

#### 15.讲一下隔离级别？

#### 16.如何解决脏读/不可重读/幻读？能不加锁吗？

#### 17.知道MVCC吗？

#### 18.redo log和undo log有什么区别？
